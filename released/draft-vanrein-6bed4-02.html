<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>6bed4: Peer-to-Peer IPv6 on Any Internetwork</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Terminology"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Wire Format of 6bed4 Frames"/>
<link href="#rfc.section.3" rel="Chapter" title="3 6bed4-Prefixed Address Format"/>
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Invitations for Direct Connections"/>
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Interpretation of EUI-64 flag bits"/>
<link href="#rfc.section.4" rel="Chapter" title="4 6bed4 Infrastructure and Protocol Overview"/>
<link href="#rfc.section.5" rel="Chapter" title="5 NAT and Firewall Traversal"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Filtering 6bed4 Traffic"/>
<link href="#rfc.section.7" rel="Chapter" title="7 Routing 6bed4 Traffic"/>
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 Network Endpoint Routing Options"/>
<link href="#rfc.section.8" rel="Chapter" title="8 Opportunistic Peering"/>
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 Abstract Framework for Direct Peering"/>
<link href="#rfc.section.8.2" rel="Chapter" title="8.2 Neighbor-Discovery-based Direct Peering"/>
<link href="#rfc.section.8.3" rel="Chapter" title="8.3 Routing-based Direct Peering"/>
<link href="#rfc.section.8.4" rel="Chapter" title="8.4 Invitation-based Direct Peering"/>
<link href="#rfc.section.8.5" rel="Chapter" title="8.5 TCP-based Direct Peering"/>
<link href="#rfc.section.8.6" rel="Chapter" title="8.6 SCTP-based Direct Peering"/>
<link href="#rfc.section.8.7" rel="Chapter" title="8.7 SIP-supported Direct Peering"/>
<link href="#rfc.section.9" rel="Chapter" title="9 Support for Robust Header Compression"/>
<link href="#rfc.section.10" rel="Chapter" title="10 Requirements for 6bed4 Infrastructure Components"/>
<link href="#rfc.section.10.1" rel="Chapter" title="10.1 Requirements for 6bed4 Servers"/>
<link href="#rfc.section.10.2" rel="Chapter" title="10.2 Requirements for 6bed4 Peers"/>
<link href="#rfc.section.11" rel="Chapter" title="11 Implementation Considerations"/>
<link href="#rfc.section.12" rel="Chapter" title="12 IANA Considerations"/>
<link href="#rfc.section.13" rel="Chapter" title="13 Security Considerations"/>
<link href="#rfc.section.14" rel="Chapter" title="14 Acknowledgements"/>
<link href="#rfc.references" rel="Chapter" title="15 Normative References"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.4.8 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Van Rein, R." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-vanrein-6bed4-02" />
  <meta name="dct.issued" scheme="ISO8601" content="2014-10-14" />
  <meta name="dct.abstract" content="The purpose of 6bed4 is to support IPv6-only applications, even on IPv4-only networks.  A specific and new " />
  <meta name="description" content="The purpose of 6bed4 is to support IPv6-only applications, even on IPv4-only networks.  A specific and new " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">Network Working Group</td>
  <td class="right">R. Van Rein</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">OpenFortress B.V.</td>
</tr>
<tr>
  <td class="left">Intended status: Experimental</td>
  <td class="right">October 14, 2014</td>
</tr>
<tr>
  <td class="left">Expires: April 17, 2015</td>
  <td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">6bed4: Peer-to-Peer IPv6 on Any Internetwork<br />
  <span class="filename">draft-vanrein-6bed4-02</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>The purpose of 6bed4 is to support IPv6-only applications, even on IPv4-only networks.  A specific and new <a href="#RFC7059">[RFC7059]</a> area of concern is that of peer-to-peer protocols such as SIP or document exchange during a chat session.  Such protocols are designed to run in arbitrary environments, which means that they can neither rely on native IPv6 for themselves, nor for their peers.  The 6bed4 tunnel mechanism ensures that IPv6 can be assumed on all peers.  This has a positive impact on the ability to initiate direct exchanges between such peers.</p>
<p>The 6bed4 mechanism is meant as a fallback mechanism for IPv6 connectivity on networks that do not support it natively, by running a tunnel over UDP and IPv4.  The IPv4 address is used to support traceability of the traffic originator, which means that no user account or other configuration is needed.</p>
<p>The tunnel mechanism encapsulates IPv6 in UDP/IPv4 and builds on existing IPv6 discovery mechanisms; it employs Stateless Address Autoconfiguration <a href="#RFC4862">[RFC4862]</a> to setup an IPv6 address on a 6bed4 Peer, and Neighbor Discovery <a href="#RFC4861">[RFC4861]</a> to verify if a most direct route to a remote 6bed4 Peer is possible.</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on April 17, 2015.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2014 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Terminology</a></li>
<li>2.   <a href="#rfc.section.2">Wire Format of 6bed4 Frames</a></li>
<li>3.   <a href="#rfc.section.3">6bed4-Prefixed Address Format</a></li>
<li>3.1.   <a href="#rfc.section.3.1">Invitations for Direct Connections</a></li>
<li>3.2.   <a href="#rfc.section.3.2">Interpretation of EUI-64 flag bits</a></li>
<li>4.   <a href="#rfc.section.4">6bed4 Infrastructure and Protocol Overview</a></li>
<li>5.   <a href="#rfc.section.5">NAT and Firewall Traversal</a></li>
<li>6.   <a href="#rfc.section.6">Filtering 6bed4 Traffic</a></li>
<li>7.   <a href="#rfc.section.7">Routing 6bed4 Traffic</a></li>
<li>7.1.   <a href="#rfc.section.7.1">Network Endpoint Routing Options</a></li>
<li>8.   <a href="#rfc.section.8">Opportunistic Peering</a></li>
<li>8.1.   <a href="#rfc.section.8.1">Abstract Framework for Direct Peering</a></li>
<li>8.2.   <a href="#rfc.section.8.2">Neighbor-Discovery-based Direct Peering</a></li>
<li>8.3.   <a href="#rfc.section.8.3">Routing-based Direct Peering</a></li>
<li>8.4.   <a href="#rfc.section.8.4">Invitation-based Direct Peering</a></li>
<li>8.5.   <a href="#rfc.section.8.5">TCP-based Direct Peering</a></li>
<li>8.6.   <a href="#rfc.section.8.6">SCTP-based Direct Peering</a></li>
<li>8.7.   <a href="#rfc.section.8.7">SIP-supported Direct Peering</a></li>
<li>9.   <a href="#rfc.section.9">Support for Robust Header Compression</a></li>
<li>10.   <a href="#rfc.section.10">Requirements for 6bed4 Infrastructure Components</a></li>
<li>10.1.   <a href="#rfc.section.10.1">Requirements for 6bed4 Servers</a></li>
<li>10.2.   <a href="#rfc.section.10.2">Requirements for 6bed4 Peers</a></li>
<li>11.   <a href="#rfc.section.11">Implementation Considerations</a></li>
<li>12.   <a href="#rfc.section.12">IANA Considerations</a></li>
<li>13.   <a href="#rfc.section.13">Security Considerations</a></li>
<li>14.   <a href="#rfc.section.14">Acknowledgements</a></li>
<li>15.   <a href="#rfc.references">Normative References</a></li>
<li><a href="#rfc.authors">Author's Address</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#terms" id="terms">Terminology</a></h1>
<p id="rfc.section.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119 <a href="#RFC2119">[RFC2119]</a>.</p>
<p/>

<dl>
  <dt>6bed4 Frame:</dt>
  <dd style="margin-left: 8">A network frame or packet that consists of an IPv6 frame encapsulated into UDP and then into IPv4.</dd>
  <dt>6bed4 Address:</dt>
  <dd style="margin-left: 8">The combination of an IPv4 address and a UDP port number.  This pair of coordinates is used to indicate a UDP/IPv4 endpoint for 6bed4 Frames.   A Source 6bed4 Address is a 6bed4 Address comprising of a source IPv4 address and source UDP port; a Destination 6bed4 Address is a 6bed4 Address comprising of a destination IPv4 address and destination UDP port.  A 6bed4 Address is called Direct if it represents the coordinates of an endpoint; a 6bed4 Address is called General if it addresses a 6bed4 Server.</dd>
  <dt>6bed4-Prefixed Address:</dt>
  <dd style="margin-left: 8">An IPv6 address that begins with the standard prefix TBD1::/32 which defines the rest of the address as holding a General and (usually) a Direct 6bed4 Address.</dd>
  <dt>6bed4 Server:</dt>
  <dd style="margin-left: 8">A router in the 6bed4 communication path.  When receiving 6bed4 Frames, it is validated and either relayed as native IPv6 traffic or bounced as a 6bed4 Frame towards the destination's 6bed4-Prefixed Address.  In addition, a 6bed4 Server takes care of a few discovery tasks.</dd>
  <dt>6bed4 Peer:</dt>
  <dd style="margin-left: 8">An endpoint in the 6bed4 communication path.  These are places where IPv6 traffic is wrapped into 6bed4 Frames, or unwrapped.  Note that configurations may exist where further communication over IPv6 takes place, but the peer remains the endpoint for 6bed4-embedded frames.</dd>
  <dt>6bed4 Infrastrucure:</dt>
  <dd style="margin-left: 8">The combination of 6bed4 Peers and 6bed4 Servers.</dd>
  <dt>/n Prefix:</dt>
  <dd style="margin-left: 8">When n is at most 32, we use this notation to refer to an IPv4 prefix.  When n is over 32, we use this notation to refer to an IPv6 prefix.</dd>
  <dt>/32+n Prefix:</dt>
  <dd style="margin-left: 8">This is always an IPv6 prefix, with a length of 32+n bits, with n at least 0 and at most 32.  The first 32 bits and the first 32 bits of TBD1:: are the same.  This notation improves readability when /32+n prefixes in a 6bed4-Prefixed Address are compared to /n prefixes in IPv4 addresses.</dd>
  <dt>Native IPv6 Address:</dt>
  <dd style="margin-left: 8">An IPv6 address that is not routed over 6bed4, Teredo <a href="#RFC4380">[RFC4380]</a> or 6to4 <a href="#RFC3056">[RFC3056]</a>.  In other words, an IPv6 address that matches none of the prefixes TBD1::/32, 2001:0000::/32, 2002::/16.  Synonyms used in this document are "native address", or simply "native".</dd>
  <dt>Internal Address:</dt>
  <dd style="margin-left: 8">An IPv4 address as specified in <a href="#RFC1918">[RFC1918]</a> or <a href="#RFC6598">[RFC6598]</a>, or an IPv6 address defined as Link-Local in <a href="#RFC4291">[RFC4291]</a>.</dd>
  <dt>Public Address:</dt>
  <dd style="margin-left: 8">An address as observed by any arbitrary observer on the public Internet, so outside of any layer of Network Address/Port Translation.  Formally, it is defined as any address that is not an internal address.</dd>
  <dt>NAT:</dt>
  <dd style="margin-left: 8">An translation mechanism, usually located in an IPv4 router, that rewrites Internal Addresses (and ports) into Public Addresses (and ports), and conversely.  Very often, the translation from Public to Internal Addresses (and ports) is constrained by local policy.</dd>
  <dt>UDP/IPv4 Stream:</dt>
  <dd style="margin-left: 8">A term that loosely refers to the back-and-forth exchanges of UDP frames over IPv4 between two specific 6bed4 Addresses.  Note that the 6bed4 protocol sends keepalive messages to keep a started stream open with respect to filtering and address/port translation.</dd>
  <dt>6bed4 Connection:</dt>
  <dd style="margin-left: 8">The exchange of 6bed4 Frames between two 6bed4 endpoints.  This is run over an UDP/IPv4 stream.  When the endpoints of that stream are both Direct 6bed4 Addresses, then the 6bed4 connection is also called Direct.  Otherwise, the 6bed4 connection may be referred to as a General connection to make explicit that frames travel through at least one 6bed4 Server.</dd>
  <dt>Endpoint-Dependent Mapping:</dt>
  <dd style="margin-left: 8">Any mapping between 6bed4 Addresses that is not an endpoint-independent mapping according to <a href="#RFC4787">[RFC4787]</a>.  In terms of this RFC, for some values of Y2:y2 the value of X1':x1' differs from X2':x2'.</dd>
  <dt>RoHC:</dt>
  <dd style="margin-left: 8">Robust Header Compression, as defined in <a href="#RFC3095">[RFC3095]</a>.</dd>
  <dt>RoHC Profile:</dt>
  <dd style="margin-left: 8">A compression/decompression profile that describes how RoHC treats a particular class of traffic, and how its compressed headers are transferred.  Every RoHC Profile is described by an IANA-registered profile identifier.</dd>
  <dt>RoHC CID:</dt>
  <dd style="margin-left: 8">Each compression/decompression context, run over a 6bed4 Connection, is identified by an (RoHC) Context Identifier, or (RoHC) CID.  As part of the setup of a CID, an RoHC Profile is assigned, to enable decompressing future traffic identified with the CID.  The context holds concrete field values and patterns that can be used by the decompressor.</dd>
  <dt>RoHC IR Packet:</dt>
  <dd style="margin-left: 8">Initialization and Refresh packet, effectively defining concrete field values and patterns for an RoHC profile run under the given CID.  The IR packet is the RoHC traffic that assigns a Profile to a CID.</dd>
  <dt>RoHC STATIC-NACK:</dt>
  <dd style="margin-left: 8">This is a form of feedback, sent separately or piggy-backed, to indicate that an IR Packet is not acceptable to the decompressing recipient.  The traffic is sent in the reverse direction over the 6bed4 Conncetion that carried the objectionable IR Packet.</dd>
</dl>

<p> </p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#wireformat" id="wireformat">Wire Format of 6bed4 Frames</a></h1>
<p id="rfc.section.2.p.1">A 6bed4 Frame is constructed from an IPv6 frame by embedding it into UDP and IPv4.  In that form, it is transmitted over the Internet.  The source IPv4 address and source UDP port together are referred to as the frame's Source 6bed4 Address; the destination IPv4 address and destination UDP port together are referred to as the frame's Destination 6bed4 Address.</p>
<p id="rfc.section.2.p.2">This specification uses only two types of content for a 6bed4 Frame, namely an IPv6 frame or an RoHC packet.  The distinction between these two content types can be made based on the first nibble of the content, which is 6 for IPv6 and either 14 or 15 for an RoHC packet.  The purpose of an RoHC packet is either to update state information, or to convey a header-compressed IPv6 packet.  The stream of 6bed4 Frames arriving at a destination filters through an RoHC decompressor and results in a stream of 6bed4 Frames containing IPv6 frames.  A wide range of RoHC implementation complexity is supported, including trivial implementations.</p>
<p id="rfc.section.2.p.3">After the decompressor, the content of a 6bed4 Frame is always an IPv6 frame.  Its source IPv6 address encodes the Source 6bed4 Address, and the destination IPv6 address encodes the Destination 6bed4 Address.  In fact, there are two variants of each Destination 6bed4 Address depending on how the destination is reached, namely a Direct 6bed4 Address and a General 6bed4 Address; both are included in the IPv6 addresses.</p>
<p id="rfc.section.2.p.4">Since 6bed4 embedding supports general IPv6 traffic, it provides a well-defined form for carrying around ICMPv6 messages, including Neighbor Discovery messages.  These are actively used to negotiate with 6bed4 Peers.  Router Solicitation and Advertisement are used to determine a Public IPv6 Address; Neighbor Solicitation and Advertisement are used to test and confirm if a remote 6bed4 Peer can be reached at the Direct 6bed4 Address.</p>
<p id="rfc.section.2.p.5">Router Advertisements in 6bed4 Frames announce /114 prefixes.  This leaves 14 bits that can be used locally to distinguish hosts under the same prefix, possibly managed through static assignment and/or DHCPv6.  Note that the completion with all zero bits indicates the router <a href="#RFC4291">[RFC4291]</a>, or more precisely, the 6bed4 Server that is the sender of the Router Advertisement.</p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#addressformat" id="addressformat">6bed4-Prefixed Address Format</a></h1>
<p id="rfc.section.3.p.1">A 6bed4 Address is conceptually a pair of an IPv4 address and a UDP port.  A representation of this information as drawn below would show these parts in the given order, and each represented in network byte order.  Every 6bed4-Prefixed Address is known to at least contain a General 6bed4 Address; furthermore, somewhat dependent on a few flags as discussed below, the same address usually also holds a Direct 6bed4 Address.</p>
<p>Conceptual Representation of a 6bed4 Address:</p>
<pre>
+--------+--------+--------+--------+--------+--------+
| IPv4.H | IPv4.h | IPv4.l | IPv4.L | UDP.H  | UDP.L  |
+--------+--------+--------+--------+--------+--------+
    8        8        8        8        8        8
</pre>
<p id="rfc.section.3.p.2">In places where link-scoped addresses <a href="#RFC4291">[RFC4291]</a> are used, they look like a standard fe80::/10 prefix followed by zero bit padding and ending in the six bytes IPv4.H, IPv4.h, IPv4.l, IPv4.L, UDP.H and UDP.L.</p>
<p id="rfc.section.3.p.3">The representation of the General 6bed4 Address is founded on the knowledge that each 6bed4 Server runs on the standard UDP port TBD2.  This information is not mentioned in the 6bed4-Prefixed Address, but the IPv4 address is completely shown in the top 64 bits of the 6bed4-Prefixed Address.  The resulting sequence is: </p>

<ul>
  <li>The four bytes IPv4.H, IPv4.h, IPv4.l and IPv4.L.</li>
</ul>

<p> </p>
<p id="rfc.section.3.p.4">Assuming it is there, the representation of the Direct 6bed4 Address is also not entirely straightforward; it goes into the lower half of the 6bed4-Prefixed Address, but it must respect the two bits that must be set in the EUI-64 interface identifier (Section 2.5.1 of <a href="#RFC4291">[RFC4291]</a>).  The bits in those position are placed behind the rest of the Direct 6bed4 Address.  The resulting sequence in the representation is, in network byte order: </p>

<ul>
  <li>The highest six bits of IPv4.H;</li>
  <li>A bit value 0 to indicate that the address is not made globally unique through the use of an Organizationally Unique Identifier <a href="#IEEE-EUI64">[IEEE-EUI64]</a> <a href="#RFC2372">[RFC2372]</a>;</li>
  <li>A bit value 0 to indicate that the address does not address a group <a href="#IEEE-EUI64">[IEEE-EUI64]</a> <a href="#RFC2372">[RFC2372]</a>;</li>
  <li>The three bytes IPv4.h, IPv4.l and IPv4.L;</li>
  <li>The two bytes UDP.H and UDP.L;</li>
  <li>The lowest two bits of IPv4.H.</li>
</ul>

<p> </p>
<p id="rfc.section.3.p.5">The last part of the 6bed4-Prefixed Address concerns the 14 bits that follow after the /114 from the Router Advertisement.  This part is left to the local 6bed4 endpoint to fill.  The only thing to be mindful about is that the continuation with all zero bits is reserved (Section 2.6.1 of <a href="#RFC4291">[RFC4291]</a>) for the on-link address of the router that sent the prefix.  This part will be denoted as "lanip" in the following diagram.</p>
<p id="rfc.section.3.p.6">The general format of a 6bed4-Prefixed address that can be embedded as 6bed4 is as follows: </p>

<p>The IPv6 address for 6bed4:</p>
<pre>
 0               32              64                       114    128
 +-------+-------+-------+-------+-------+-------+-------+-------+
 |      TBD1     | Gen 6bed4 Addr| Direct 6bed4 Address   | lanip|
 +-------+-------+-------+-------+-------+-------+-------+-------+
 &lt;--------------------- /114 prefix ----------------------&gt;
</pre>
<p id="rfc.section.3.p.7">The well-known TBD1::/32 prefix is important; it enables routing software to recognise this format in IPv6 addresses, and realise that traffic may be sent to either of the 6bed4 Addresses contained in the IPv6 address.</p>
<p id="rfc.section.3.p.8">Note how it takes a /32+32 Prefix to describe the route to a particular 6bed4 Server; however, when the IPv4 address of this server is contained in a /16 prefix it is possible to publish a /32+16 Prefix, which is rather common.  More on global routing follows in <a href="#globalrouting">Section 7</a>.</p>
<p id="rfc.section.3.p.9">The prefix TBD1::/32 and port TBD2 are only reserved for a period of ten years, starting at the date of publication of this specification.  Implementations that are aware of time MUST NOT implement 6bed4 after the final date; an extension of the final date is only possible through an updating RFC that at least passes through expert review for both allocated resources.  The ten-year period supports five years for new applications to roll out IPv6 applications based on 6bed4, and another five years for the use of 6bed4 to cease to exist and native IPv6 to replace it.</p>
<h1 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1.</a> Invitations for Direct Connections</h1>
<p id="rfc.section.3.1.p.1">One special condition in a 6bed4-Prefixed Address can be treated as an invitation for Direct 6bed4 Connections, namely when the General and Direct 6bed4 Address are the same.  In terms of the address format, this means that the IPv4 addresses are the same, and that the UDP port in the Direct 6bed4 Address is the 6bed4 standard port TBD2.</p>
<p id="rfc.section.3.1.p.2">No 6bed4 Peer could announce this form of IPv6 Address without being able to receive 6bed4 Frames from anyone on its Direct 6bed4 Address; for this reason, this special format can be exploited to always make Direct 6bed4 Connections to this 6bed4-Prefixed Address; details are given in <a href="#invitedopportunisticpeering">Section 8.4</a>.</p>
<h1 id="rfc.section.3.2"><a href="#rfc.section.3.2">3.2.</a> <a href="#eui64flagbits" id="eui64flagbits">Interpretation of EUI-64 flag bits</a></h1>
<p id="rfc.section.3.2.p.1">The address format specified above specifies that the Universal/Local bit is set to Local, and that the Individual/Group bit is set to Inidividual <a href="#IEEE-EUI64">[IEEE-EUI64]</a>.  Within IPv6 addresses <a href="#RFC2372">[RFC2372]</a>, these choices are both represented with bit value 0.</p>
<p id="rfc.section.3.2.p.2">Should a 6bed4-Prefixed Address set either or both these bits to 1, then the entire bottom half of such remote peer addresses MUST be treated as an opaque bit array under this specification; only local extensions to this specification are possible, but not defined here.  If the bottom half is treated as an opaque bit array, a Direct 6bed4 Address MUST NOT be retrievable from the 6bed-Prefixed Address.</p>
<p id="rfc.section.3.2.p.3">What remains in such situations is to address the General 6bed4 Address when sending traffic to such addresses.  Effectively, this leaves the interpretation of the bottom half of the 6bed4-Prefixed Address to the 6bed4 Server appointed in the top half.  This leaves room for various interpretations and (local) extensions.</p>
<p id="rfc.section.3.2.p.4">One suggested extension is to support multicast destinations with a 6bed4-Prefixed Address that has the Individual/Group bit set to 1.  The 6bed4 Server mentioned in the top half can forward traffic over sparse or dense multicast networks, based on local policy; one example local policy would route to all nodes on a locally connected network; another example local policy would route to all nodes that have explicitly subscribed to a particular multicast channel.</p>
<p id="rfc.section.3.2.p.5">Another suggested extension is to support Stateless Address Autoconfiguration <a href="#RFC4862">[RFC4862]</a> on a local network segment, based on a 6bed4 Server that handles port TBD2 for a Public IPv4 address.  Such extensions MUST suppress Public IPv6 Addresses specified as Local and Individual, which could arise from manually specified addresses or from privacy extensions <a href="#RFC4941">[RFC4941]</a>.  Permitting such addresses to occur as Public IPv6 Addresses would be misinterpreted to contain a Direct 6bed4 Address, and would therefore lead to routing problems.</p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#networkinfra" id="networkinfra">6bed4 Infrastructure and Protocol Overview</a></h1>
<p id="rfc.section.4.p.1">This specification does not refer to parts of the 6bed4 Infrastructure as tunnel clients and tunnel servers, but rather as 6bed4 Peers and 6bed4 Servers.  This reflects the intention of making the endpoints, or peers, use Direct UDP/IPv4 Streams as their preferred transport for 6bed4 Connections.</p>
<p id="rfc.section.4.p.2">The purpose of a 6bed4 Server is to provide information about the Public IPv6 Address to 6bed4 Peers, and to permit fallback to General 6bed4 Streams as a transport mechanism between 6bed4 Peers for which Direct UDP/IPv4 Streams are not feasible.  Finally, the 6bed4 Server is needed to connect a host that can only do 6bed4 to one that can only do Native IPv6 Addresses; precautions to avoid that situation wherever possible follow.</p>
<p id="rfc.section.4.p.3">To be reachable to the outside world on a Public IPv6 Address, a 6bed4 Peer sends a Router Solicitation to a 6bed4 Server, and receives a Router Advertisement with a /114 prefix in response.  As shown in <a href="#wireformat">Section 2</a>, the returned prefix includes both the General and Direct 6bed4 Address for the local endpoint, and leaves some room for local address assignment.  It is then the local 6bed4 Peer's task to keep open the UDP/IPv4 Stream to the 6bed4 Server, so as to ensure that the IPv6 address remains constant.  If it were to change, then the server would respond to sent traffic with a new Router Advertisement, offering a new /114 prefix and retracting the previous one.  This situation is usually avoided by sending regular keepalive messages.</p>
<p id="rfc.section.4.p.4">When initiating a new 6bed4 Connection, in other words when first contacting a remote 6bed4 Peer, it is also possible to send a Router Solicitation to the General 6bed4 Address found in the remote 6bed4 Address.  This results in an alternate 6bed4-Prefixed Address that can be setup locally for that contact attempt, avoiding trapezium-shaped routing between 6bed4 Peers.  This specification ensures that this mechanism will always work, but a similar responsibility to keep this link to the remote 6bed4 Server open falls upon the local system.</p>
<p id="rfc.section.4.p.5">Finally, for the most agressive approach towards peer-to-peer connections, it is even possible to send the Router Solicitation to the Direct 6bed4 Address of the approached peer.  Note that it is also possible for peers inviting this method to copy their Direct 6bed4 Address in the General 6bed4 Address, if they ensure that traffic always ends up on the 6bed4 endpoint.  It should be noted that it is not generally possible to rely on just trying the Direct 6bed4 Address if certainty of the connection is required; the General 6bed4 Address must also be used to achieve this certainty, except when it is the same as the Direct 6bed4 Address, in which case the Router Solicitations would be the same.</p>
<p id="rfc.section.4.p.6">At any time before or during communication with a 6bed4 Peer through a 6bed4 Server, it is possible to try using a Direct UDP/IPv4 Stream by sending a Neighbor Solicitation from a local Direct 6bed4 Address to the peer's Direct 6bed4 Address, and observing if it is matched by a Neighbor Advertisement over the opposite path.  In this, "matched" means that it MUST be certain that the Neighbor Advertisement was not sent in response to a Neighbor Solicition that went out over another channel.  <a href="#opportunism">Section 8</a> presents a few alternatives to this standard method.</p>
<p id="rfc.section.4.p.7">When such direct requests lead to matching direct responses, then it is safe to assume that a Direct UDP/IPv4 Stream is possible between the 6bed4 Peers, at least for some time following.  This is because UDP/IPv4 has worked in both directions, and the fact that it contained ICMPv6 cannot be inferred by the intermediate NAT routers or firewalls because the UDP format does not tag its contents.  To ensure that this assumption continues to hold, firewalls and NAT routers MUST NOT interpret frames from and to the standard 6bed4 port TBD2 as 6bed4 Frames, but simply as UDP traffic.</p>
<p id="rfc.section.4.p.8">The knowledge that a remote 6bed4 Address can be reached over a certain UDP/IPv4 Stream MUST NOT be assumed to also apply to communication with any other IPv6 Address.  This is vital, as it evades the trap of making inductive assumptions about the behaviour of NAT or firewalls.  See <a href="#nattraversal">Section 5</a> for details of the deductive approach of 6bed4 regarding regarding NAT and firewalls.</p>
<p id="rfc.section.4.p.9">It is common for IPv6 hosts to have multiple IPv6 addresses, and so the question arises which local and remote addresses to use.  This has been answered in <a href="#RFC6724">[RFC6724]</a>.  In relation to 6bed4, native-to-native traffic MUST precede 6bed4-to-6bed4.  In addition, 6bed4-to-6bed4 SHOULD be preferred over either native-to-6bed4 and 6bed4-to-native, because it is more desirable to use a Direct UDP/IPv4 Stream than a General UDP/IPv4 Stream through a 6bed4 Server.  Every 6bed4 Server is ultimately a shared resource and thereby a potential bottle neck for routing efficiency.  This choice implies that 6bed4 Servers are offloaded.</p>
<p id="rfc.section.4.p.10">In addition to this optimisation, higher-layer applications MAY also incorporate knowledge of 6bed4; for instance, a SIP endpoint <a href="#RFC3261">[RFC3261]</a> could observe a remote peer's 6bed4-Prefixed Address and offer media exchange over a 6bed4-Prefixed Address instead of a Native IPv6 Address, once more so as to offload the shared resource of a 6bed4 Server, and to achieve lower roundtrip delays and jitter.  It could even aim to construct a more optimal 6bed4-Prefixed Address for the connection using the techniques mentioned in <a href="#sipopportunisticpeering">Section 8.7</a>.</p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#nattraversal" id="nattraversal">NAT and Firewall Traversal</a></h1>
<p id="rfc.section.5.p.1">There is a wide variety of NAT router implementations, each with subtly different characteristics.  A similar thing applies to firewalls.  This means that any approach to peering through NAT and firewalls that is to work everywhere must be founded on deductive reasoning-from-facts, and not induce information from an incomplete survey of NAT routers and firewalls.  Specifically, STUN <a href="#RFC3489">[RFC3489]</a> used to make such inductions which were later relativated (Section 14.3 <a href="#RFC5389">[RFC5389]</a>).  An IPv6 tunneling mechanism based on this work <a href="#RFC4380">[RFC4380]</a> has indeed shown to not work in general <a href="#POTAROO">[POTAROO]</a>.</p>
<p id="rfc.section.5.p.2">Network components that alter the contents of UDP frames have been reported <a href="#RFC4380">[RFC4380]</a> but are downright broken.  They may need to be replaced before 6bed4 can function; unlike Teredo, 6bed4 will not reduce the risk of running into what are bugs by obfuscation of addresses and ports contained in 6bed4 Frames.</p>
<p id="rfc.section.5.p.3">This specification assumes that outgoing UDP is supported.  This may not work for every network that claims to offer Internet service, but such statements are lies and will lead to more functional problems.  Although it is not defined here, one could perceive a 6bed4 Peer and 6bed4 Server to fallback to TCP, or perhaps even WebSockets <a href="#RFC6455">[RFC6455]</a> on such networks.  Performance would of course suffer as a direct result of the limited network offerings; it is invariably better to contact the local administrator to give them an opportunity to mend their ways.</p>
<p id="rfc.section.5.p.4">Except for local keepalive timing, nothing in 6bed4 makes assumptions about the behaviour of NAT beyond basic support for UDP in general.  Specifically, there is no dependency on a behavioural classification of NAT routers or firewalls.  Instead, 6bed4 simply tries if IPv6 traffic between peers is possible by sending a frame directly to a peer and matching it with a return frame.  In case of success, it is assumed that bidirectional direct peering is possible.</p>
<p id="rfc.section.5.p.5">6bed4 Connections are carried over a UDP/IPv4 stream, and UDP has no content tagging, so a NAT router cannot treat this test exchange in any way different from "normal" UDP traffic.</p>
<p id="rfc.section.5.p.6">When sending UDP out through a NAT router, it will usually substitute the source IPv4 address and UDP port with an external IPv4 address and UDP port.  For UDP protocols to behave normally in the presence of this translation, the NAT implementation is to apply the same substitution when future frames are sent over the same UDP/IPv4 Stream, so a sustained mapping between internal and external IPv4 address and UDP port can safely be assumed.</p>
<p id="rfc.section.5.p.7">To find an entry in this mapping, the NAT router can select values from the source and destination IPv4 addresses and UDP ports, but as long as all these values match, the same UDP/IPv4 stream is recognised and the same mapping must be applied.  There is no implementation freedom here; the opposite substitution is the only way to support UDP in general.</p>
<p id="rfc.section.5.p.8">Firewalls have a similar mapping, albeit not for substituting an address and port, but to recognise if traffic has been sent out over a UDP/IPv4 stream.  Other than this difference, it generally behaves under the same constraints as a mapping in a NAT router.</p>
<p id="rfc.section.5.p.9">To handle all mappings that are possible, 6bed4 makes no assumption about sharing the same mapping for different UDP/IPv4 Streams; a Public IPv4 Address and UDP Port may be the same for two remote peers, or they may differ.  As far as 6bed4 concerns, they may be separately administered mappings.  And if they happen to overlap then it is still safe to treat them separately, as the protocol components are idempotent.</p>
<p id="rfc.section.5.p.10">UDP has no formal end marker for a UDP/IPv4 Stream, so the only thing that a router can do is guess when a stream has ended.  It is assumed by this specification that a mapping is kept active for a minimum time, and revived at least when traffic is sent out along the stream, as that is the only thing on which an implementation can base such revivals without making UDP insecure.  To overcome timeouts on such mappings, a keepalive mechanism is needed in a number of places, and the timer triggering that mechanism must be a setting that the end user can influence.  Experiments <a href="#RFC4380">[RFC4380]</a> have shown that a default setting of 30 seconds is quite likely to work.  To avoid being presumptious, implementations SHOULD permit user configuration of this timeout value.</p>
<p id="rfc.section.5.p.11">UDP in general must support bidirectional streams, so when outbound traffic is passed over an UDP/IPv4 Stream, then reply traffic within that same same stream must also be accepted.  Otherwise, a firewall or NAT router would break the UDP protocol.  Note once more that there is no tagging of content in UDP, so there can only be one default policy.  There is only one way that a NAT router can redirect such traffic internally, and that is by applying the mapping for the UDP/IPv4 stream in reverse.  This will send the reply traffic back to the internal host that initiated the outbound side of the UDP/IPv4 stream, so the damage done to the UDP/IPv4 Stream is unnotice to the local endpoint (as long as it does not make its endpoint coordinates explicit to the outside World, of course).</p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#filtering" id="filtering">Filtering 6bed4 Traffic</a></h1>
<p id="rfc.section.6.p.1">Any tunnel should guard against being abused for claims on addresses "inside" the tunnel based on "outside" clients that should not be able to make such claims.  In the case of 6bed4, this means that the 6bed4 Address from which a 6bed4 Frame arrives must match with the Sender IPv6 Address.</p>
<p id="rfc.section.6.p.2">When a filter rejects a 6bed4 Frame on account of a mismatch between the Source 6bed4 Address and the suggested IPv6 address, it should respond with a Router Advertisement that retracts the /114 prefix used in the IPv6 address, and offers a new /114 prefix that would have matched to replace it.</p>
<p id="rfc.section.6.p.3">Both 6bed4 Servers and 6bed4 Peers MUST silently discard any 6bed4-embedded frame that is neither a proper IPv6 message nor an RoHC-compressed packet; example conditions to implement that would be: </p>

<ul>
  <li>the embedded frame length is less than that of an IPv6 header</li>
  <li>the embedded frame does not start with nibble 6, 14 or 16</li>
  <li>the embedded frame length differs from the total IPv6 frame length</li>
  <li>there are checksum errors in TCP, ICMPv6 or UDP headers</li>
</ul>

<p> </p>
<p id="rfc.section.6.p.4">If the recipient is a 6bed4 Server, then the Source 6bed4 Address of an acceptable 6bed4 Frame MUST match one of the following: </p>

<ul>
  <li>the Direct 6bed4 Address embedded in the Source 6bed4 Address;</li>
  <li>the General 6bed4 Address of a 6bed4 Server known to announce TBD1::/32, but only if the recipient's 6bed4 Address matches the Destination 6bed4 Address of the 6bed4 Frame.</li>
</ul>

<p> Note that 6bed4 Frames may occasionally travel through a router announced for TBD1::/32 but not when they are sent from a 6bed4-Prefixed Address, in which case it would have been forwarded to a 6bed4 Address.  </p>
<p id="rfc.section.6.p.5">If the recipient is a 6bed4 Peer, then the Source 6bed4 Address of an acceptable 6bed4 Frame MUST match one of the following: </p>

<ul>
  <li>the Direct 6bed4 Address embedded in the Source IPv6 Address, but this variation fails if it cannot be retrieved;</li>
  <li>the General 6bed4 Address embedded in the Source IPv6 Address.</li>
</ul>

<p> In addition, the Destination 6bed4 Address of an acceptable 6bed4 Frame MUST match the following: </p>

<ul>
  <li>the Direct 6bed4 Address in the Desintation IPv6 Address, but this check also succeeds if it cannot be retrieved.</li>
</ul>

<p> Finally, the destination IPv6 address SHOULD be assigned by the 6bed4 Server set as the Generic 6bed4 Address as part of the destination IPv6 address.  </p>
<p id="rfc.section.6.p.6">The situations in which a Direct 6bed4 Address cannot be retrieved are specified in <a href="#eui64flagbits">Section 3.2</a>.</p>
<p id="rfc.section.6.p.7">A 6bed4 Server MAY apply additional filtering to limit its use to a particular subset of 6bed4 Peers; for instance, the users of an ISP or a commercial 6bed4 service.  To this end, it would ensure that 6bed4 Frames are passed either from or to a Direct 6bed4 Address that is accepted.  This MUST NOT be done on a 6bed4 Server that announces routability for the TBD1::/32 prefix.</p>
<p id="rfc.section.6.p.8">The only messages exempted from all aforementioned filtering are Router Solicitation frames targeting a link-local IPv6 address, and having their IPv6 Hop Limit set to 255.  Those messages receive a Router Advertisement frame in reply, containing the /114 prefix that matches the 6bed4 Address of the originator of the solicitation.  Specifically note that even a limited-access 6bed4 Server MUST welcome Router Solicitation from unaffiliated peers that intend to avoid trapezium-shaped routing.</p>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> <a href="#globalrouting" id="globalrouting">Routing 6bed4 Traffic</a></h1>
<p id="rfc.section.7.p.1">In backbone networks, IPv6 connectivity providers exchange routes through the Border Gateway Protocol (BGP).  There is no standard for prefix lengths supported, and principally everyone makes their own filtering rules.  In practice [ref] however, a /48 is a mostly supported length, unlike anything that is longer.  The small percentage that does not support the /48 is usually capable of routing through a covering /32 IPv6 prefix.  The best approach to global routeability appears to be the combination of a /32+16 with a covering /32+0 prefix.</p>
<p id="rfc.section.7.p.2">One MUST own the IPv4 range over which routing is announced, so the announcement of a /32+16 Prefix is only possible for a 6bed4 Address that falls in a /16 prefix that is owned by the anonymous system that runs the 6bed4 Server.  An exception is made for the /32+0 Prefix, which serves as a fallback routing facility.  This fallback range can be used as anycast, so this MAY be announced by any party implementing a 6bed4 Server.  What this means is that control over return traffic is only possible through announcement of the /32+16 Prefix, with a minute portion of the Internet still routing it through the /32+0 Prefix announcement.</p>
<p id="rfc.section.7.p.3">Note that routing practice [ref] indicates that there is no global routing use in announcing prefixes longer than /32+16 if a /16 Prefix is not held around the 6bed4 Server; such longer prefixes usually do not make it to the backbone.  Also note that there is no use in announcing shorter prefixes than /32+16 if a shorter prefix than a /16 is available around the 6bed4 Server address.  This is because only a sinlge IPv4 address is addressed, and because the /32+16 prefix is the most likely to make it to the backbone.</p>
<p id="rfc.section.7.p.4">Anyone announcing a /32+16 Prefix MAY also announce the /32+0 Prefix, which is TBD1::/32 itself.  Anyone announcing the /32+0 Prefix MUST respond to all 6bed4 traffic targeted at 6bed4 Server addresses outside locally administered IPv4 ranges by relaying such traffic to a suitable IPv6 router; to that end, it MUST endeavour to collect all routing announcements for /32+16 Prefixes.</p>
<p id="rfc.section.7.p.5">Announced /32+16 Prefixes SHOULD be retracted during downtime of the 6bed4 service; announced /32 Prefixes MUST be retracted during downtime of the 6bed4 service.  It is advised to relay routing messages that establish these routes through the 6bed4 service, to the effect that service downtime implies route announcement retraction.  This would not normally interfere with intentions to setup redundant 6bed4 service.</p>
<h1 id="rfc.section.7.1"><a href="#rfc.section.7.1">7.1.</a> Network Endpoint Routing Options</h1>
<p id="rfc.section.7.1.p.1">Note that the availability of /32+0 announcements as an anycasted service makes it possible for any node with a single IPv4 address and access to the 6bed4 port TBD2 to offer 6bed4 service.  The quality level of this service is lower due to the dependency on the anycast range for more than just fallback routing.  Having said that, it also enables a model where an endpoint can run a 6bed4 service to cover  a local network.  In this case it is possible to use the local numbering scheme, as long as the respective bit in the EUI-64 address is zero.  This specifically implies that Stateless Address Autoconfiguration cannot be used to assign a 6bed4 Address on such a LAN, but DHCPv6 or manual schemes, or local-bit-flipping autoconfiguration could all work.</p>
<h1 id="rfc.section.8"><a href="#rfc.section.8">8.</a> <a href="#opportunism" id="opportunism">Opportunistic Peering</a></h1>
<p id="rfc.section.8.p.1">An explicit design goal of 6bed4 is to exploit Direct UDP/IPv4 Streams between 6bed4 Peers.  This is achieved by simply trying an exchange over UDP/IPv4 and relying on the uninterpreted transport of UDP payloads to infer that the entire UDP/IPv4 stream must be possible if a single exchange works bidirectionally.</p>
<p id="rfc.section.8.p.2">It is vitally important that UDP/IPv4 Streams follow the same path in both directions.  This is because it is only safe to assume that outgoing traffic in a UDP/IPv4 Stream keeps NAT router and firewalls open for return traffic.  Specifically, these network components need to see the same UDP ports and IPv4 addresses for the traffic in both directions, albeit with their source and destination roles exchanged.  To ensure this, a 6bed4 Peer that receives direct traffic from a remote peer that it would address through a 6bed4 Server MUST start one of the following methods to setup direct peering.  In such cases, it may not give up before it has tried the Neighbor Discovery method, which is the only obliged method.</p>
<p id="rfc.section.8.p.3">The one thing left to specify is how peering is initiated.  This is done by one of the following methods to setup direct peering, applied opportunistically.  This can basically be done at any time deemed fitting, but it is suggested to employ some form of rate limiting for opportunistic peering attempts.  A few useful places to do this would be to send a Router Advertisement to a direct 6bed4 Address before sending it to its general 6bed4 Address; or to send Neighbor Discovery sometime during the normal exchange; or to do it during the setup of a TCP/IPv6 stream.</p>
<p id="rfc.section.8.p.4">The following subsections introduce a general framework for setting up direct peering.  It continues with a few concrete examples, some of which must be implemented with 6bed4.  There are certainly opportunities for other specific implementations of the general opportunistic mechanism.</p>
<h1 id="rfc.section.8.1"><a href="#rfc.section.8.1">8.1.</a> <a href="#generalopportunisticpeering" id="generalopportunisticpeering">Abstract Framework for Direct Peering</a></h1>
<p id="rfc.section.8.1.p.1">The abstract concept of direct peering rests on sending a message directly to a Direct 6bed4 Peer, in an attempt to establish bidirectional contact.  The "official" version is to create a dedicated message exchange for this purpose, but many protocols could support the "trick" of trying a first message towards the Direct 6bed4 Address and, if this fails and higher-layer protocols decide to resend, to continue the exchange through the General 6bed4 Address.  The latter approach is a slight abuse of the known-lossy nature of networks.</p>
<p id="rfc.section.8.1.p.2">The abstract framework must be able to relate an incoming direct reply to an outgoing direct request, and only a direct outgoing request.  This can be established with a nonce if a frame is generated specifically for the purposes of 6bed4 Peer detection; or if a higher protocol layer generates the message, then the time between the first send and a later re-send is the window during which the direct response is considered a reliable sign of bidirectional traffic.</p>
<h1 id="rfc.section.8.2"><a href="#rfc.section.8.2">8.2.</a> <a href="#neighboropportunisticpeering" id="neighboropportunisticpeering">Neighbor-Discovery-based Direct Peering</a></h1>
<p id="rfc.section.8.2.p.1">One mechanism that MUST be implemented in all 6bed4 Peers is that of peering setup through Neighbor Discovery.  This involves a Neighbor Solictation generated by the 6bed4 Peer over a Direct UDP/IPv4 Stream, and receiving a reply in the form of a Neighbor Advertisement.  In short, this is standaard reachability detection for IPv6.  The usual ICMPv6 requirement of a Hop Limit equal to 255 applies here, and is not invalidated by the underlying UDP/IPv4 transport.</p>
<p id="rfc.section.8.2.p.2">In order to ensure that a response matches a request sent directly, as well as to thwart attemts to overtake traffic, a nonce following <a href="#RFC6496">[RFC6496]</a> MUST be sent as part of the Neighbor Solicitation.  A 6bed4 Peer MUST respond to Neighbor Solicitation with Hop Limit 255 and its own address information as destination with a Neighbor Advertisement with Hop Limit 255, and it MUST include any nonce it found in the Neighbor Solicitation.</p>
<p id="rfc.section.8.2.p.3">A 6bed4 Peer wanting to initiate a Direct 6bed4 Connection may use this mechanism at any time; it is safe because it does not interfere with the actual data stream between the peers.  These internally generated Neighbor Discovery messages SHOULD NOT be sent to the 6bed4 Server.  Only when a direct Neighbor Solicitation results in a Neighbor Advertisement with the same nonce may the originator of the exchange conclude that a Direct 6bed4 Connection can be used.  The remote peer MUST NOT draw that conclusion, as it cannot be sure if the direct Neighbor Advertisement arrived.  Also in the interest of security, it should initiate its own exchange.</p>
<h1 id="rfc.section.8.3"><a href="#rfc.section.8.3">8.3.</a> <a href="#routeropportunisticpeering" id="routeropportunisticpeering">Routing-based Direct Peering</a></h1>
<p id="rfc.section.8.3.p.1">Another mechanism that SHOULD be implemented in 6bed4 Peers, and that MUST be implemented in 6bed4 Servers, is responding to Router Discovery messages with the Hop Limit set to 255.  The response must be a Router Solicitation composed of the /114 prefix formed as defined in <a href="#addressformat">Section 3</a>; the General 6bed4 Address refers to the 6bed4 Server for the address, the Direct 6bed4 Address holds to the observed UDP port and IPv4 address of the sender of the Router Discovery message.  Any nonces included in the Router Discovery MUST be replicated in the Router Solicitation.  Furthermore, a 6bed4 Peer MUST include a nonce if it sends out a Router Discovery message.</p>
<h1 id="rfc.section.8.4"><a href="#rfc.section.8.4">8.4.</a> <a href="#invitedopportunisticpeering" id="invitedopportunisticpeering">Invitation-based Direct Peering</a></h1>
<p id="rfc.section.8.4.p.1">The simplest possible form of opportunistic direct routing is when the 6bed4-Prefixed address of a remote peer has the same values set as its General and Direct 6bed4 Address.  This means that the opportunistic route can be tried immediately, as the 6bed4 Server function requires accessibility over the standard UDP port TBD2 that is apparently also in use for Direct 6bed4 Connections.</p>
<p id="rfc.section.8.4.p.2">Note that it is usually necessary to obtain a 6bed4-Prefixed Address to use for communication with such a party, so if no local IPv6 address with the same /64 as the remote peer's IPv6 address exists, then one should be requested from the remote peer through Router Solicitation.  This will inform the local peer how its public address looks to the inviting peer.</p>
<h1 id="rfc.section.8.5"><a href="#rfc.section.8.5">8.5.</a> <a href="#tcpopportunisticpeering" id="tcpopportunisticpeering">TCP-based Direct Peering</a></h1>
<p id="rfc.section.8.5.p.1">This mechanism MAY be incorporated into 6bed4 implementations that run TCP over 6bed4.  It piggy-backs on the SYN and ACK flags exchanged while setting up a TCP connection to a remote 6bed4 Peer, and introduces peering opportunistically and, quite possibly, without any exchanges with a 6bed4 Server for setting it up.</p>
<p id="rfc.section.8.5.p.2">TCP-based peering is based on the SYN flag sent initially by a new TCP connection being setup, and the ACK flag sent to acknowledge it.  Furthermore, it assumes that the TCP stack wil resend a failed first SYN attempt.</p>
<p id="rfc.section.8.5.p.3">The first SYN sent to a remote 6bed4 Peer would be sent to the Direct 6bed4 Address of the remote peer; if it reports back with the ACK flag set, then a direct connection was clearly possible.  If this response does not arrive before the TCP-stack re-sends the SYN fame, then this and further attempts are sent to the General 6bed4 Address, until further inspiration triggers another attempt at direct peering.</p>
<p id="rfc.section.8.5.p.4">The endpoint information in TCP as well as window offsets are used to recognise the SYN attempt, and later pairing the ACK to it.  This means that the conditions are available for certainty that a direct attempt is paired with a direct response.</p>
<p id="rfc.section.8.5.p.5">Note that this mechanism works in both directions; as the passive side responds to a SYN with ACK, it usually sends its own SYN flag in hope of an ACK back from the active side.  This second exchange can follow the same rules to detect bidirectional connectivity from the other side.  Sending that first ACK along with the second SYN also means that a first attempt is made through direct peering.</p>
<p id="rfc.section.8.5.p.6">This facility is useful for servers that have configured their NAT and Firewalls to open a UDP port, so any direct contact attempts are certain to succeed.  This can be used to construct a fixed 6bed4 Address, which would be suitable for publication in DNS.  Although the Invitations of <a href="#invitedopportunisticpeering">Section 8.4</a> are a special form of this approach, the TCP-based approach covers many more situations.</p>
<h1 id="rfc.section.8.6"><a href="#rfc.section.8.6">8.6.</a> <a href="#sctpopportunisticpeering" id="sctpopportunisticpeering">SCTP-based Direct Peering</a></h1>
<p id="rfc.section.8.6.p.1">The Opportunistic Peering method for SCTP <a href="#RFC4960">[RFC4960]</a> is a variation on the method for TCP.  Note that SCTP does not have the usual acceptance problems when used between 6bed4 Peers, because 6bed4 traffic is largely unfiltered and tunnels through the NAT routers that currently tend to block this protocol.</p>
<p id="rfc.section.8.6.p.2">SCTP follows an association initiation protocol with four frames instead of the three of TCP.  The last two may carry data chunks, but this would be stored in a separate chunk, giving the network layer some freedom to manipulate the frames if desired.</p>
<p id="rfc.section.8.6.p.3">The advantage of four messages over three is that the first chunk (INIT) can be sent first to the Direct 6bed4 Address, then to the General 6bed4 Address of the remote peer, which can then assume that outgoing UDP traffic has opened a hole in NAT and Firewalls.  This means that the chances of entry for a reply message are optimal.  Therefore, the opportunistic method for SCTP relies on the remaining three chunks of association initiation.</p>
<p id="rfc.section.8.6.p.4">The INIT-ACK chunk counts as an opportunistic attempt from the remote to the local peer when it arrives over the Direct UDP/IPv4 Stream; the COOKIE chunk sent over the Direct UDP/IPv4 stream signals acceptance to the remote peer and is at the same time an opportunistic attempt from the local peer to the remote; the COOKIE ECHO chunk sent over the Direct UDP/IPv4 Stream signals acceptance to the local peer.</p>
<p id="rfc.section.8.6.p.5">In short, new SCTP associations can send the first attempt of each of the chunks for association initiation to the Direct 6bed4 Address of a peer.  With the exception of INIT, the arrival of a chunk over the General UDP/IPv4 Stream indicates that the SCTP association must continue through the 6bed4 Server.</p>
<h1 id="rfc.section.8.7"><a href="#rfc.section.8.7">8.7.</a> <a href="#sipopportunisticpeering" id="sipopportunisticpeering">SIP-supported Direct Peering</a></h1>
<p id="rfc.section.8.7.p.1">Another example of opportunistic peering that can be advantageous for a specific application is SIP <a href="#RFC3261">[RFC3261]</a>.  A SIP exchange consists of a request and one or more responses.  The application software is well aware of the distinction between those, and can prove useful to facilitate 6bed4 peering if it integrates with the network layers.</p>
<p id="rfc.section.8.7.p.2">SIP messages, when sent over UDP, are prone to resends if a response is not received for some time.  As a result, it is possible to first attempt sending to the remote peer's Direct 6bed4 Address, and send later retries to the General 6bed4 Address.  As with TCP, it is possible to treat as proof of direct peering any incoming direct responses between the intial request and its re-sends through the General 6bed4 Address.</p>
<p id="rfc.section.8.7.p.3">The link between a SIP request and its response is easily made with the identifying parts of the message; these are embedded in text and would thus rely on application integration with 6bed4.  The parts are contained in the Call-ID: header, From: tag and optional To: tag.  In addition, the top Via: header contains a branch parameter that identifies the exchange.  All this is the knowledge domain of the application, and could take too much from the 6bed4 tunneling code, so instead of support such protocols directly it is a sign that an extended API between the 6bed4 stack and the application can be advantageous.</p>
<h1 id="rfc.section.9"><a href="#rfc.section.9">9.</a> <a href="#rohc" id="rohc">Support for Robust Header Compression</a></h1>
<p id="rfc.section.9.p.1">The RoHC framework <a href="#RFC3095">[RFC3095]</a> exploits repetitive and predictable patterns in headers to achieve header compression, and defines a reliable protocol for it.  At least two field applications of 6bed4 make this compression desirable, namely as a peer-to-peer carrier for RTP flows and as a tunneling mechanism to gain access to IPv6 over mobile networks.  In support of these and other schemes, 6bed4 incorporates support for RoHC between peers, even if though the minimal implementation provides just enough support to reliably reject it, so RoHC can be attempted between peers without loss of robustness.</p>
<p id="rfc.section.9.p.2">The RoHC specification allows a number of predefined values for various settings. These will not be negotiated by 6bed4, but are defined here for the general application. Take note that a specific application MAY overrule these default choices, and come to a more generally useful approach to using RoHC.</p>
<p/>

<ul>
  <li>The CID value 0x00 is predefined for profile 0x0000, RoHC uncompressed traffic. Since this CID value is not explicitly sent as part of RoHC frames, traffic can be sent unchanged and still pass through an RoHC decompressor as it should;</li>
  <li>Any RoHC-traffic besides uncompressed traffic is sent with the first nibble value 14 or 15, which is distinguishable from the start nibble 6 for IPv6 frames. RoHC defines a padding byte that could be used before any (future) byte that starts with another nibble than 14 or 15;</li>
  <li>LARGE_CIDS is true, and MAX_CID is correspondingly set to 16383; CID value 0 MUST NOT be sent and CID values 1 to 15 inclusive MAY be represented in the short form; larger CID values MUST be represented in the longer form in 1 or 2 bytes; recipients of RoHC packets MUST be able to process both long and short CID forms;</li>
  <li>The MRRU value is 1280;</li>
  <li>It is advised to provide support for at least the profiles 0x0000, 0x0101, 0x0102, 0x0103, 0x0104 and 0x0006; these are ROHC uncompressed, RoHCv2 RTP, RoHCv2 UDP, RoHCv2 ESP, RoHCv2 IP, RoHC TCP.</li>
</ul>

<p> </p>
<p id="rfc.section.9.p.4">RoHC can be very useful between 6bed4 Peers.  On a 6bed4 Server, the use of RoHC on the encapsulated IPv6 header would imply keeping state, which counters our intentions.  For this reason, this specification only defines the possibility of sending RoHC traffic to a 6bed4 Peer, and permits a 6bed4 Server to drop all RoHC traffic without further notice.</p>
<p id="rfc.section.9.p.5">The constraints on 6bed4 Peers and 6bed4 Servers for RoHC handling are detailed in Section <a href="#requirements">Section 10</a>; their definition is such that traffic to a 6bed4 Peer may be compressed with RoHC, but when a new profile is introduced the receiving side may reject it through negative feedback.  This is interpreted as lack of support for that profile, and (robustly) avoids compression according to that particular profile.</p>
<p id="rfc.section.9.p.6">Future specifications, as well as local uses of this specification may choose to overrule any of these definitions, for instance to use large CIDs or to equip a 6bed4 Server with RoHC capabilities; this could be very useful on cellular links and other dedicated service channels.</p>
<h1 id="rfc.section.10"><a href="#rfc.section.10">10.</a> <a href="#requirements" id="requirements">Requirements for 6bed4 Infrastructure Components</a></h1>
<p id="rfc.section.10.p.1">This section describes minimum requirements for 6bed4 Servers and 6bed4 Peers.</p>
<h1 id="rfc.section.10.1"><a href="#rfc.section.10.1">10.1.</a> <a href="#serverreqs" id="serverreqs">Requirements for 6bed4 Servers</a></h1>
<p id="rfc.section.10.1.p.1">A 6bed4 Server MUST respond to well-formed Router Solicitations from any 6bed4 Peer, including non-local and non-member requests, by advertising the /114 prefix that starts with the well-known prefix TBD1::/32, followed by its own 6bed4 Address in the position of the General 6bed4 Address, and the requesting 6bed4 Address as the Direct 6bed4 Address.  The 6bed4 Server MUST know its own 6bed4 Address as a combination of a configured public IPv4 address and the UDP port TBD2 and it MUST be reachable for anyone at the resulting 6bed4 Address.</p>
<p id="rfc.section.10.1.p.2">A 6bed4 Server MUST filter incoming 6bed4 Frames as specified in <a href="#filtering">Section 6</a>.  When a 6bed4 Frame is rejected on account of its Source 6bed4 Address, then the same Router Advertisement MUST be sent in response, with the extension that the falsely assumed /114 prefix from the source IPv6 address is also retracted.</p>
<p id="rfc.section.10.1.p.3">When responding to Neighbor Solicitation or Router Solicitation, a 6bed4 Server MUST copy any nonce and timing information from the request into the response.</p>
<p id="rfc.section.10.1.p.4">A 6bed4 Server MAY publish Prefixes of its IPv6 address with lengths between /32+0 and /32+32 through the Border Gateway Protocol (BGP) with at least the 6bed4 Address that it assigns in Router Advertisements as the General 6bed4 Address, and MAY be published in BGP with a larger prefix.  The 6bed4 Server MUST receive all native IPv6 traffic sent to this published prefix.</p>
<p id="rfc.section.10.1.p.5">A 6bed4 Server SHOULD forward IPv6 frames sent to 6bed4-Prefixed Addresses after embedding them in a 6bed4 Frame; the Destination 6bed4 Address is the Direct 6bed4 Address if the General 6bed4 Address matches the server's 6bed4 Address, or otherwise the Destination 6bed4 Address is the General 6bed4 Address.</p>
<p id="rfc.section.10.1.p.6">A 6bed4 Server SHOULD forward 6bed4 Frames destined for IPv6 Addresses that do not fall under the TBD1::/32 prefix.  This is done by unpacking the 6bed4 Frames, or in other words, by removing the UDP and IPv4 headers.</p>
<p id="rfc.section.10.1.p.7">A 6bed4 Server SHOULD forward 6bed4 Frames destined for a 6bed4-Prefixed Address to the next hop 6bed4 Address.  If the destination IPv6 Address holds the 6bed4 Server's address as the General 6bed4 Address, then the next hop is the Direct 6bed4 Address found in the destination IPv6 address.  Otherwise, the next hop is the General 6bed4 Address found in the destination IPv6 address.</p>
<p id="rfc.section.10.1.p.8">The "SHOULD" conformance level in the last three paragraphs is a conscious limitation of the service, in support for commercial 6bed4 offerings.  However, if the 6bed4 Server announces router prefixes of at least 32 bits valued TBD1, then any IPv6 Frames whois source or destination IPv6 Address matches one such prefix MUST be forwarded as described by the last three paragraphs.</p>
<p id="rfc.section.10.1.p.9">A 6bed4 Server MAY discard 6bed4-embedded RoHC packets, which can be recognised by their first nibble value being 14 or 15, instead of 6 for a plain IPv6 frame.  When dropping RoHC packets, a 6bed4 Server MUST NOT send 6bed4-embedded RoHC packets either.  When processing RoHC packets, the 6bed4 Server MUST behave in the same way as a 6bed4 Peer, and respect the rules of Section <a href="#rohc">Section 9</a>.</p>
<h1 id="rfc.section.10.2"><a href="#rfc.section.10.2">10.2.</a> <a href="#peerreqs" id="peerreqs">Requirements for 6bed4 Peers</a></h1>
<p id="rfc.section.10.2.p.1">A 6bed4 Peer SHOULD respond to well-formed Router Solicitations from any 6bed4 Peer, and to invalid incoming 6bed4 Frames from any source with a Router Advertisement, by advertising the /114 prefix that starts with the well-known prefix TBD1::/32, followed by its own 6bed4 Address in the position of the General 6bed4 Address, and the requesting 6bed4 Address as the Direct 6bed4 Address.  The 6bed4 Peer may obtain its own 6bed4 Address from the Destination 6bed4 Address of the incoming 6bed4 Frame.</p>
<p id="rfc.section.10.2.p.2">A 6bed4 Peer MUST filter incoming 6bed4 Frames as specified in <a href="#filtering">Section 6</a>.  When a 6bed4 Frame is rejected on account of its Source 6bed4 Address, then the same Router Advertisement MUST be sent in response, with the extension that the falsely assumed /114 prefix from the source IPv6 address is also retracted.</p>
<p id="rfc.section.10.2.p.3">When setting up a 6bed4 Connection to a remote 6bed4 Address, a 6bed4 Peer SHOULD prefer any address for the local side of the 6bed4 Connection that starts with the same /64 prefix as the remote 6bed4 Peer's.  If no such address is available locally, it is RECOMMENDED to acquire one by sending a Router Solicitation to the remote peer's General and/or Direct 6bed4 Address.</p>
<p id="rfc.section.10.2.p.4">A 6bed4 Peer MUST respond to received Neighbor Solicitation messages with Neighbor Discovery messages, to implement Opportunistic Peering as specified in <a href="#generalopportunisticpeering">Section 8.1</a>.  It MAY also implement other mechanisms for Opportunistic Peering.</p>
<p id="rfc.section.10.2.p.5">When communicating over a 6bed4 Connection, it is RECOMMENDED that a 6bed4 Peer attempts to setup a Direct 6bed4 Connection according to the Optimistic Peering procedures described in <a href="#generalopportunisticpeering">Section 8.1</a>.</p>
<p id="rfc.section.10.2.p.6">When receiving 6bed4 Frames over a Direct 6bed4 Connection when not being setup to perform direct 6bed4 Peering to the Source 6bed4 Address, a 6bed4 Peer MUST work towards Optimistic Peering, and Neighbor Solicitation MUST be one of the opportunistic mechanisms tried before considering failure.  If attempts towards Optimistic Peering are already in motion for the same remote 6bed4 Peer, then its result may be awaited first.</p>
<p id="rfc.section.10.2.p.7">A 6bed4 Peer SHOULD send a nonce and timing information <a href="#RFC6496">[RFC6496]</a> in any sent Neighbor Solicitation and Router Solicitation.</p>
<p id="rfc.section.10.2.p.8">When responding to Neighbor Solicitation or Router Solicitation, a 6bed4 Peer MUST copy any nonce and timing information from the request into the response.</p>
<p id="rfc.section.10.2.p.9">A 6bed4 Peer SHOULD send keepalive frames to keep the UDP/IPv4 Stream open for active 6bed4 Connections.  A keepalive frame MAY be a valid IPv6 frame, or it may be an empty message embedded in UDP and IPv4 as would have been done for an IPv6 frame.  It MAY be sent with an IPv4 Time To Live that is so low that the keepalive frame just makes it to the public Internet, after having crossed local NAT routers and firewalls.  The timing interval of a keepalive frame SHOULD be a user setting, and it MAY by default be set to a safe low value of 30 seconds.</p>
<p id="rfc.section.10.2.p.10">When received over a Direct 6bed4 Connection, a 6bed4 Peer MUST accept 6bed4 Frames with initial nibble values 14 and 15.  It must process them as RoHC packets, adhering to the rules in Section <a href="#rohc">Section 9</a>.  In case of an IR packet that mentions an unsupported profile number, it MUST respond with a STATIC-NACK.  Compressed RoHC packets may be reconstructed into 6bed4 Frames and are then considered as a freshly arrived 6bed4 Frame.</p>
<p id="rfc.section.10.2.p.11">A 6bed4 Peer MAY attempt RoHC compression over Direct 6bed4 Connections.  It may introduce any profile number that it wants, but should be prepared to deal with (repeated) STATIC-NACK on an IR packet to indicate that the recipient is not able to engage in that profile.  If this happens, the sender SHOULD back off temporarily or definately for the given 6bed4 Connection and/or the remote 6bed4 Address.  To limit loss of 6bed4 Frames caused by IR packet rejections, a 6bed4 Peers SHOULD NOT include a payload with an IR packet.</p>
<p id="rfc.section.10.2.p.12">A 6bed4 Peer SHOULD deliver any 6bed4 Frames by unwrapping it (meaning, removing the IPv4 and UDP headers) and locally process the contained IPv6 frame, and it should accept local IPv6 frames originating at one of its local 6bed4-Prefixed Addresses, and wrap it into UDP and IPv4 to send to the destination, either to the Direct or General 6bed4 Address contained in the IPv6 destinationsaddres.</p>
<h1 id="rfc.section.11"><a href="#rfc.section.11">11.</a> Implementation Considerations</h1>
<p id="rfc.section.11.p.1">One potential implementation of a 6bed4 tunnel interface would exploit the Neighbor Cache in an IPv6 host to facilitate storage and timing of the various neighboring relationships.  Indeed, the timeouts of such relations are generally shorter than NAT mapping timeouts.  It should however be noted that not all Neighbor Caches are designed for large-scale operation, and that an active host could choke on that.  Furthermore, there is no keepalive mechanism built into such neighbor caches, which means that one or more peering relations could loose their address when no traffic is exchanged for some time.</p>
<p id="rfc.section.11.p.2">For ISPs that do not provide 6bed4, there is no problem to reach out to more distant 6bed4 service providers.  It is even thinkable that such a service would be offered on a commercial basis, and that traffic through the service would only be passed through when it either passes to or from a customer's registered address (range).  Such a service provider obviously should not announce that it can route the TBD1::/32 prefix.</p>
<p id="rfc.section.11.p.3">Although this specification speaks only of UDP as a transport for 6bed4, it is possible to add TCP as a fallback protocol if the code of the 6bed4 Peer and 6bed4 Server agree to that.  Although SCTP would be more suitable, it is not likely to find a situation where that is present and UDP is not.  What is common is that UDP is banned while TCP is not.  Such cases could benefit from a fallback to TCP.  The format of the messages exchanged would be precisely the same, except that the transmission happens to be ordered and guaranteed.  As one more option to cator to failed Internet installations, one could even consider supporting TCP over port 80 or 443 instead of the standard port.  In all cases, the 6bed4 Server should now be aware of all connected 6bed4 Peers, and choose to contact them over TCP instead of UDP, as would normally be the case.  This can be remedied in various ways, with differentiation through the 6bed4 Address of the server being the easiest.</p>
<p id="rfc.section.11.p.4">Another option based on protocol extensions to which 6bed4 Server and 6bed4 Peer could agree, is to apply encryption to the information exchanged.  Such facilities are not part of this specification.</p>
<p id="rfc.section.11.p.5">A few situations call for coordination between 6bed4 Infrastructure components.  This will take place under the domain name 6bed4.net for as long as the TBD1::/32 prefix and the TBD2 port are allocated for 6bed4.  The precise methods are not detailed here because it does not concern the core communication protocols of the 6bed4 tunneling mechanism.  One thing coordinated under 6bed4.net is an service where Autonomous Systems who announce TBD1::/32 routing must register all IPv4 addresses of 6bed4 Servers that could pass on 6bed4 traffic to a machine with a longer prefix that did not make it through to all parts of the Internet.</p>
<h1 id="rfc.section.12"><a href="#rfc.section.12">12.</a> <a href="#iana" id="iana">IANA Considerations</a></h1>
<p id="rfc.section.12.p.1">This specification reserves a 32-bit address prefix TBD1::/32 in the IPv6 address space assigned to the IANA IPv6 Special-Purpose Address Registry.  The prefix will be exclusively used for 6bed4 addresses, and further assigned as defined in <a href="#addressformat">Section 3</a>.  Addresses under this prefix can be used as source and destination addresses, are forwardable and global.  The termination date for the allocation falls ten years after the publication date of this specification in the Request For Comments series; future standardisation work could modify the end date if this is considered useful.</p>
<p id="rfc.section.12.p.2">This specification also reserves Port TBD2 from the pool of UDP ports and from the pool of TCP ports for the period of ten years, starting from the date of publication of this specification, also subject to possible updates by future specifications.</p>
<p id="rfc.section.12.p.3">The port TBD2 will be the port on which 6bed4 Servers provide their services.</p>
<p><a id="CREF1" class="info">[CREF1]<span class="info">Rick: Requests to IANA / to be removed after processing: The requested assignment for TBD1 is 2001:64, so TBD1::/32 allocates 2001:64::/32 from 2001::/23 The requested assignment for TBD2 is 27629, which is written in hex as 6bed </span></a> </p>
<h1 id="rfc.section.13"><a href="#rfc.section.13">13.</a> <a href="#security" id="security">Security Considerations</a></h1>
<p id="rfc.section.13.p.1">Tunneling mechanisms must always be on their guard for wrapped packets containing false origins <a href="#RFC6169">[RFC6169]</a>.  To shield against this, 6bed4 ensures that the source IPv4 address and UDP port of the together match either the Direct or General 6bed4 Address contained in the source IPv6 address.</p>
<p id="rfc.section.13.p.2">Note that this facility works best when address filtering <a href="#BCP38">[BCP38]</a> is applied.  In lieu of authentication facilities for frame source, the best that the 6bed4 tunnel can do is to avoid worsening the problems of incomplete address filtering.</p>
<p id="rfc.section.13.p.3">One exception arises with the possibility that a target 6bed4-Prefixed Address publishes a /32+16 Prefix which is not seen everywhere on the Internet; or that such a prefix is not actually published at all.  In such situations, a 6bed4 Frame may be routed to a TBD1::/32 route, which passes it on to the General 6bed4 Address contained in the IPv6 destination address.  The list of routers that can pass on such traffic will generally be limited, and will be maintained externally to this specification, but documented on 6bed4.net.  Routes announced to larger IP space than owned by the publishing Anonymous System MUST be registered on 6bed4.net so as to distinguish them from abuse.  The domain will publish processible information that helps 6bed4 Servers to recognise this distinction too.</p>
<p id="rfc.section.13.p.4">It is important to realise that 6bed4 bypasses NAT and Firewalls.  This is a feature inasfar as it enables peer-to-peer connectivity, but it also implies a responsibility to not lightly attach services to a 6bed4-Prefixed Address.  There is no protection, other than what is being added.  Specifically noteworthy is that the operator of the 6bed4 Server cannot implement filtering on behalf of their customers; the ability to use Direct 6bed4 Connections would bypass this, and since this could happen at any time such filtering could not even be realiably made connection-aware.</p>
<h1 id="rfc.section.14"><a href="#rfc.section.14">14.</a> Acknowledgements</h1>
<p id="rfc.section.14.p.1">This work has evolved from a simple, and perhaps simplistic protocol to its current form.  I owe gratitude to many who contributed.</p>
<p id="rfc.section.14.p.2">Special thanks go to SURFnet, for generally supporting the idea of 6bed4 and providing long-term support for the first public 6bed4 Server, as well as supporting the expansion of the initial tunnel investigation work into a generally useful publication <a href="#RFC7059">[RFC7059]</a>.</p>
<p id="rfc.section.14.p.3">Thanks for financial support in developing phases of the specification and coding of 6bed4 are due towards NLnet Foundation, as well as SURFnet.</p>
<p id="rfc.section.14.p.4">I owe gratitude to the NLUUG, ISOC NL and RIPE communities for discussing prior tunnel designs and pointing out scaling and routing problems; although the protocol has become more complex it also has become more dependable and, I think, more generally acceptable.</p>
<p id="rfc.section.14.p.5">Another word of thanks goes to Limesco, for being the first mobile provider to adopt 6bed4 so their users can access IPv6 networks from their mobile devices.</p>
<p id="rfc.section.14.p.6">Finally, the work in this tunnel design has required a creative mind set in which technical concepts were highly fluid and changing.  Although it would be difficult to point out a direct link or assign an economic figure, the ability to think in such a mode has clearly been influenced by independent, thought-provoking, boundary-breaking artistic expression.  I cherish art in all its forms for its incredible power to help us be imaginative and innovative in the field of technology.</p>
<h1 id="rfc.references"><a href="#rfc.references">15.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="IEEE-EUI64">[IEEE-EUI64]</b>
      </td>
      <td class="top"><a>IEEE</a>, "<a>Guidelines for 64-bit Global Identifier (EUI-64TM)</a>", December 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC1918">[RFC1918]</b>
      </td>
      <td class="top"><a href="mailto:yakov@cisco.com" title="Cisco systems">Rekhter, Y.</a>, <a href="mailto:rgm3@is.chrysler.com" title="Chrysler Corporation">Moskowitz, R.</a>, <a href="mailto:Daniel.Karrenberg@ripe.net" title="RIPE Network Coordination Centre">Karrenberg, D.</a>, <a href="mailto:GeertJan.deGroot@ripe.net" title="RIPE Network Coordination Centre">Groot, G.</a> and <a href="mailto:lear@sgi.com" title="Silicon Graphics, Inc.">E. Lear</a>, "<a href="http://tools.ietf.org/html/rfc1918">Address Allocation for Private Internets</a>", BCP 5, RFC 1918, February 1996.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2119">[RFC2119]</b>
      </td>
      <td class="top"><a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2372">[RFC2372]</b>
      </td>
      <td class="top"><a href="mailto:Keith.Evans@Tandem.Com" title="Tandem Computers Inc, LOC 252-30">Evans, K.</a>, <a href="mailto:Johannes.Klein@Tandem.Com" title="Tandem Computers Inc.">Klein, J.</a> and <a href="mailto:JimLyon@Microsoft.Com" title="Microsoft Corporation">J. Lyon</a>, "<a href="http://tools.ietf.org/html/rfc2372">Transaction Internet Protocol - Requirements and Supplemental Information</a>", RFC 2372, July 1998.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3056">[RFC3056]</b>
      </td>
      <td class="top"><a>Carpenter, B.</a> and <a>K. Moore</a>, "<a href="http://tools.ietf.org/html/rfc3056">Connection of IPv6 Domains via IPv4 Clouds</a>", RFC 3056, February 2001.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3095">[RFC3095]</b>
      </td>
      <td class="top"><a>Bormann, C.</a>, <a>Burmeister, C.</a>, <a>Degermark, M.</a>, <a>Fukushima, H.</a>, <a>Hannu, H.</a>, <a>Jonsson, L-E.</a>, <a>Hakenberg, R.</a>, <a>Koren, T.</a>, <a>Le, K.</a>, <a>Liu, Z.</a>, <a>Martensson, A.</a>, <a>Miyazaki, A.</a>, <a>Svanbro, K.</a>, <a>Wiebke, T.</a>, <a>Yoshimura, T.</a> and <a>H. Zheng</a>, "<a href="http://tools.ietf.org/html/rfc3095">RObust Header Compression (ROHC): Framework and four profiles: RTP, UDP, ESP, and uncompressed</a>", RFC 3095, July 2001.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3261">[RFC3261]</b>
      </td>
      <td class="top"><a>Rosenberg, J.</a>, <a>Schulzrinne, H.</a>, <a>Camarillo, G.</a>, <a>Johnston, A.</a>, <a>Peterson, J.</a>, <a>Sparks, R.</a>, <a>Handley, M.</a> and <a>E. Schooler</a>, "<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>", RFC 3261, June 2002.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3489">[RFC3489]</b>
      </td>
      <td class="top"><a>Rosenberg, J.</a>, <a>Weinberger, J.</a>, <a>Huitema, C.</a> and <a>R. Mahy</a>, "<a href="http://tools.ietf.org/html/rfc3489">STUN - Simple Traversal of User Datagram Protocol (UDP) Through Network Address Translators (NATs)</a>", RFC 3489, March 2003.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4291">[RFC4291]</b>
      </td>
      <td class="top"><a>Hinden, R.</a> and <a>S. Deering</a>, "<a href="http://tools.ietf.org/html/rfc4291">IP Version 6 Addressing Architecture</a>", RFC 4291, February 2006.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4380">[RFC4380]</b>
      </td>
      <td class="top"><a>Huitema, C.</a>, "<a href="http://tools.ietf.org/html/rfc4380">Teredo: Tunneling IPv6 over UDP through Network Address Translations (NATs)</a>", RFC 4380, February 2006.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4787">[RFC4787]</b>
      </td>
      <td class="top"><a>Audet, F.</a> and <a>C. Jennings</a>, "<a href="http://tools.ietf.org/html/rfc4787">Network Address Translation (NAT) Behavioral Requirements for Unicast UDP</a>", BCP 127, RFC 4787, January 2007.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4861">[RFC4861]</b>
      </td>
      <td class="top"><a>Narten, T.</a>, <a>Nordmark, E.</a>, <a>Simpson, W.</a> and <a>H. Soliman</a>, "<a href="http://tools.ietf.org/html/rfc4861">Neighbor Discovery for IP version 6 (IPv6)</a>", RFC 4861, September 2007.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4862">[RFC4862]</b>
      </td>
      <td class="top"><a>Thomson, S.</a>, <a>Narten, T.</a> and <a>T. Jinmei</a>, "<a href="http://tools.ietf.org/html/rfc4862">IPv6 Stateless Address Autoconfiguration</a>", RFC 4862, September 2007.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4941">[RFC4941]</b>
      </td>
      <td class="top"><a>Narten, T.</a>, <a>Draves, R.</a> and <a>S. Krishnan</a>, "<a href="http://tools.ietf.org/html/rfc4941">Privacy Extensions for Stateless Address Autoconfiguration in IPv6</a>", RFC 4941, September 2007.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4960">[RFC4960]</b>
      </td>
      <td class="top"><a>Stewart, R.</a>, "<a href="http://tools.ietf.org/html/rfc4960">Stream Control Transmission Protocol</a>", RFC 4960, September 2007.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5389">[RFC5389]</b>
      </td>
      <td class="top"><a>Rosenberg, J.</a>, <a>Mahy, R.</a>, <a>Matthews, P.</a> and <a>D. Wing</a>, "<a href="http://tools.ietf.org/html/rfc5389">Session Traversal Utilities for NAT (STUN)</a>", RFC 5389, October 2008.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6169">[RFC6169]</b>
      </td>
      <td class="top"><a>Krishnan, S.</a>, <a>Thaler, D.</a> and <a>J. Hoagland</a>, "<a href="http://tools.ietf.org/html/rfc6169">Security Concerns with IP Tunneling</a>", RFC 6169, April 2011.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6455">[RFC6455]</b>
      </td>
      <td class="top"><a>Fette, I.</a> and <a>A. Melnikov</a>, "<a href="http://tools.ietf.org/html/rfc6455">The WebSocket Protocol</a>", RFC 6455, December 2011.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6496">[RFC6496]</b>
      </td>
      <td class="top"><a>Krishnan, S.</a>, <a>Laganier, J.</a>, <a>Bonola, M.</a> and <a>A. Garcia-Martinez</a>, "<a href="http://tools.ietf.org/html/rfc6496">Secure Proxy ND Support for SEcure Neighbor Discovery (SEND)</a>", RFC 6496, February 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6598">[RFC6598]</b>
      </td>
      <td class="top"><a>Weil, J.</a>, <a>Kuarsingh, V.</a>, <a>Donley, C.</a>, <a>Liljenstolpe, C.</a> and <a>M. Azinger</a>, "<a href="http://tools.ietf.org/html/rfc6598">IANA-Reserved IPv4 Prefix for Shared Address Space</a>", BCP 153, RFC 6598, April 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6724">[RFC6724]</b>
      </td>
      <td class="top"><a>Thaler, D.</a>, <a>Draves, R.</a>, <a>Matsumoto, A.</a> and <a>T. Chown</a>, "<a href="http://tools.ietf.org/html/rfc6724">Default Address Selection for Internet Protocol Version 6 (IPv6)</a>", RFC 6724, September 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7059">[RFC7059]</b>
      </td>
      <td class="top"><a>Steffann, S.</a>, <a>van Beijnum, I.</a> and <a>R. van Rein</a>, "<a href="http://tools.ietf.org/html/rfc7059">A Comparison of IPv6-over-IPv4 Tunnel Mechanisms</a>", RFC 7059, November 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="BCP38">[BCP38]</b>
      </td>
      <td class="top"><a>Ferguson, P.</a> and <a>D. Senie</a>, "<a href="http://tools.ietf.org/html/rfc2827">Network Ingress Filtering: Defeating Denial of Service Attacks which employ IP Source Address Spoofing</a>", BCP 38, RFC 2827, May 2000.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="POTAROO">[POTAROO]</b>
      </td>
      <td class="top"><a title="APNIC">Huston, G.</a>, "<a href="http://www.potaroo.net/ispcol/2011-04/teredo.html">Testing Teredo</a>", April 2011.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Author's Address</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Rick van Rein</span> 
	  <span class="n hidden">
		<span class="family-name">Van Rein</span>
	  </span>
	</span>
	<span class="org vcardline">OpenFortress B.V.</span>
	<span class="adr">
	  <span class="vcardline">Haarlebrink 5</span>

	  <span class="vcardline">
		<span class="locality">Enschede</span>,  
		<span class="region">Overijssel</span> 
		<span class="code">7544 WP</span>
	  </span>
	  <span class="country-name vcardline">The Netherlands</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:rick@openfortress.nl">rick@openfortress.nl</a></span>

  </address>
</div>

</body>
</html>
